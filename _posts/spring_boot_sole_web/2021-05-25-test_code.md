---
layout: post
title: Test code And Lombok
date: 2021-05-22
category: start-spring-boot
author: jhhong0509
short-description: Introduce test code again and Lombok
---
------

# 테스트코드 및 롬복
### 테스트코드
- 이름
    - 클래스 이름은 테스트할 컨트롤러의 이름뒤에 Test를 붙인 것
- 테스트코드의 어노테이션들
    - @RunWith
        - @RunWith는 테스트의 실행 방법을 학장시켜 준다.
        - Junit과 스프링 부트 테스트간의 연결자 역할
    - @WebMvcTest
        - 테스트를 Web에 집중하도록 해준다.
        - 장점
            - 몇몇 어노테이션을 제한함으로써 조금 더 가벼운 테스트가 가능하다.
        - 단점
            - 모두 Mock 기반으로 하기 때문에 동작하지 않을 수 있다.
    - @Autowired
        - 스프링이 관리하는 Bean을 주입받는다.
        - 원래 XML 파일에서 하나하나 직접 등록해야 했던것과 다르게, @Bean을 생성된 객체를 @Autowired를 통해 받아올 수 있다.
    - mvc.perform(get("/hello"))
        - hello라는 주소로 get 요청을 보낸다.
        - 뒤에 .을 통해 여러가지 기능을 사용할 수 있다.(체이닝)
    - .andExpect(status().isOk())
        - 반환된 http 상태코드가 내가 원하던 값인지 검증한다
        - 실패의 테스트 경우로 .isBadRequest()와 같이 사용할 수 있다.
        - 주로 사용되는 HTTP 상태코드
            - 1xx
                - 계속 요청을 보내도 된다는 의미라고 하지만, 실험적인 경우를 제외하고는 서버에서 걸러야 한다고 한다.
                - 이 경우는 인터넷의 개발자들이 한번도 못봤다고 한다..
            - 2xx
                - 요청을 성공적으로 수행했을 경우
                - 200
                    - isOk()이다.
                    - 단순히 요청한 작업의 성공을 의미한다
                    - 대부분의 상황에서 클라이언트는 요청의 종류를 알기 때문에 200만 사용해도 문제가 없다.
                - 201
                    - isCreated()이다.
                    - 리소스의 생성이 성공했다는걸 의미한다.
                    - 게시글 생성, 회원가입 등이 있다.
                - 204
                    - isNoContent()이다.
                    - 요청을 성공적으로 수행했고, 요청과 관련된 컨텐츠가 존재하지 않음을 의미한다.
                    - 데이터 삭제 등에 사용된다.
            - 3xx
                - 리다이렉션 관련 코드
                - 사용자가 원하는 리소스가 옮겨지거나 삭제되어서 리소스에 접근할 수 없고, 다른 URL을 통해서 해당 리소스에 접근할 수 있다면, 해당 리소스의 위치를 알려준다.
                - 301
                    - 3xx번대중 가장 많이 쓰인다.
                    - 만약 헤더에 Location이 있다면, 해당 Location으로 이동한다.
                    - 그러니까 원래 이동하려던 URL에서 해당 리소스가 없다면 다른 URL로 이동시켜준다.
            - 4xx
                - 클라이언트의 요청이 잘 못 되었을때 발생하는 에러다.
                - 대부분 프론트엔드의 잘못이다.
                - 400
                    - isBadRequest()이다.
                    - 클라이언트의 요청이 잘못됨 이라는 의미이다.
                - 401
                    - isUnauthorized()이다.
                    - 토큰 값이 없다는 의미이다.
                    - 즉, 인증이 필요한 api를 요청했을 때, 토큰이 없으면 발생한다.
                - 403
                    - isForbiddened이다.
                    - 토큰 값이 없다는 것과 다르게, 토큰의 유무와 관계없이 접근이 불가능할때 사용된다.
                - 404
                    - isNotFound()이다.
                    - 리소스가 없다는 의미이다.
                - 405
                    - isMethodNotAllowed()이다.
                    - 해당 메소드가 허용되지 않았다는 의미이다.
                    - 즉, 게시글에 Post와 Get 요청만이 가능한데, Patch 요청을 하면 발생한다.
            - 5xx
                - 백엔드의 잘못이다.
                - 500
                    - isInternalServerError()이다.
                    - 예기치 못한 오류 등이 대부분이기 때문에 자세한 정보를 알려주지 않고 500만 띄우는 경우가 많다.
                - 502
                    - isBadGateway()이다.
                    - api가 죽은 것이다.
                    - api와 api 간의 연결이 원활하지 않다는 의미이다.
    - content()
        - 뒤에 .string(내용) 이나 .json(내용) 과 같은 형태를 통해 원하는 값이 반환되었는지 확인할 수 있다.
        - 뒤에 .contentType(MediaType.APPLICATION_JSON) 과 같은 형식을 통해, 반환값의 형식이 원하는 형식인지 테스트할 수 있다.
    - status()
        - 반환된 http 상태코드를 나타낸다.
    - param("name":name)
        - 파라미터로 값을 보내준다.
        - 파라미터 이름: 값 의 형식으로 쓸 수 있다.
        - 여러개를 사용할 수 있다.
        - String만 사용할 수 있다.
    - jsonPath("$.필드명",is(원하는 값))
        - json 형식에서 응답값을 필드별로 검증할 수 있다.
        - $.필드이름 과 같은 형식으로 할 수 있다.
    - @After
        - junit5에서는 @AfterEach로 사용된다.
        - 단위테스트가 끝날때마다 수행되는 메소드
        - 여러 단위테스트가 동시에 실행되면 H2(테스트용 db)에 데이터가 남아 오류가 날 수 있어서, 매 단위테스트마다 지워줘야 한다.
        - 짧게말해, 테스트간의 데이터 침범을 막는다.
    - assertj
        - assertThat
            - response를 받았을 때, 검증하고 싶은 대상을 ()에 넣어주면 가져올 수 있다.
        - isEqualTo
            - assertThat에서 가져온 값과, 내가 원하는 값과 같은지 비교해 준다.
                - assertThat(response.getTitle()).isEqualTo("원하는 제목")
### Lombok
- getter setter
    - @Getter
        - 해당되는 모든 필드에 getter 메소드를 생성한다.
    - @Setter
        - 해당되는 모든 필드에 setter 메소드를 생성한다.
- 생성자
    - @NoArgsConstructor
        - 기본생성자를 만들어 준다.
    - @RequiredArgsConstuctor
        - final 필드가 포함된 생성자를 만들어 준다.
    - @AllArgsConstructor
        - 모든 필드가 포함된 생성자를 만들어 준다
- 빌더 패턴
    - @builder
        - 빌더 패턴을 사용할 수 있게 해준다.
- NullPointerException
    - @NonNull
        - Null값을 허용하지 않겠다는 의미이다.